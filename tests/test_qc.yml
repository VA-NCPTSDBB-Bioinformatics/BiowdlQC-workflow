- name: paired_end_zipped
  tags:
    - integration
  command: >-
    bash -c '
    TEST_JSON=tests/integration/paired_end_zipped.json ;
    sed -i "2i\"QC.outputDir\":\"$PWD/test-output\"," $TEST_JSON ;
    cromwell run -i $TEST_JSON QC.wdl'
  stdout:
    contains:
      - "WorkflowSucceededState"
  files:
    # Test adapters detected
#    - path: "test-output/QC/read1/extractAdapters/adapter.list"
#      contains:
#        - "AGATCGGAAGAG"
#    - path: "test-output/QC/read2/extractAdapters/adapter.list"
#      contains:
#        - "AGATCGGAAGAG"
#    - path: "test-output/QC/read1/extractAdapters/contaminations.list"
#      contains:
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
#    # Read2 contains no contaminations
#    - path: "test-output/QC/read2/extractAdapters/contaminations.list"
#      must_not_contain:
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
#
#    # Check adapters removed
#    - path: "test-output/QCafter/read1/extractAdapters/adapter.list"
#      must_not_contain:
#        - "AGATCGGAAGAG"
#    - path: "test-output/QCafter/read2/extractAdapters/adapter.list"
#      must_not_contain:
#        - "AGATCGGAAGAG"
#    - path: "test-output/QCafter/read1/extractAdapters/contaminations.list"
#      must_not_contain:
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
#    - path: "test-output/QCafter/read2/extractAdapters/contaminations.list"
#      must_not_contain:
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
#        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"

    - path: "test-output/ct_r1_fastqc/fastqc_data.txt"
    - path: "test-output/ct_r2_fastqc/fastqc_data.txt"
    - path: "test-output/cutadapt_ct_r1_fastqc/fastqc_data.txt"
    - path: "test-output/cutadapt_ct_r2_fastqc/fastqc_data.txt"
    - path: "test-output/cutadaptReport.txt"
    - path: "test-output/cutadapt_ct_r1.fq.gz"
    - path: "test-output/cutadapt_ct_r2.fq.gz"

- name: paired_end
  tags:
    - integration
  command: >-
    bash -c '
    TEST_JSON=tests/integration/paired_end.json ;
    sed -i "2i\"QC.outputDir\":\"$PWD/test-output\"," $TEST_JSON ;
    cromwell run -i $TEST_JSON QC.wdl'
  stdout:
    contains:
      - "WorkflowSucceededState"
  files:

    # Test adapters detected
    - path: "test-output/QC/read1/extractAdapters/adapter.list"
      contains:
        - "AGATCGGAAGAG"
    - path: "test-output/QC/read2/extractAdapters/adapter.list"
      contains:
        - "AGATCGGAAGAG"
    - path: "test-output/QC/read1/extractAdapters/contaminations.list"
      contains:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
    # Read2 contains no contaminations
    - path: "test-output/QC/read2/extractAdapters/contaminations.list"
      must_not_contain:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"

    # Check adapters removed
    - path: "test-output/QCafter/read1/extractAdapters/adapter.list"
      must_not_contain:
        - "AGATCGGAAGAG"
    - path: "test-output/QCafter/read2/extractAdapters/adapter.list"
      must_not_contain:
        - "AGATCGGAAGAG"
    - path: "test-output/QCafter/read1/extractAdapters/contaminations.list"
      must_not_contain:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
    - path: "test-output/QCafter/read2/extractAdapters/contaminations.list"
      must_not_contain:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"

    - path: "test-output/QC/read1/fastqc/ct_r1_fastqc/fastqc_data.txt"
    - path: "test-output/QC/read2/fastqc/ct_r2_fastqc/fastqc_data.txt"
    - path: "test-output/QCafter/read1/fastqc/cutadapt_ct_r1_fastqc"
    - path: "test-output/QCafter/read2/fastqc/cutadapt_ct_r2_fastqc"
    - path: "test-output/AdapterClipping/cutadaptReport.txt"
    - path: "test-output/AdapterClipping/cutadapt_ct_r1.fq"
    - path: "test-output/AdapterClipping/cutadapt_ct_r2.fq"

- name: single_end_zipped
  tags:
    - integration
  command: >-
    bash -c '
    TEST_JSON=tests/integration/single_end_zipped.json ;
    sed -i "2i\"QC.outputDir\":\"$PWD/test-output\"," $TEST_JSON ;
    cromwell run -i $TEST_JSON QC.wdl'
  stdout:
    contains:
      - "WorkflowSucceededState"
  files:
    # Test adapters detected
    - path: "test-output/QC/read1/extractAdapters/adapter.list"
      contains:
        - "AGATCGGAAGAG"
    - path: "test-output/QC/read1/extractAdapters/contaminations.list"
      contains:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
    # Check adapters removed
    - path: "test-output/QCafter/read1/extractAdapters/adapter.list"
      must_not_contain:
        - "AGATCGGAAGAG"
    - path: "test-output/QCafter/read1/extractAdapters/contaminations.list"
      must_not_contain:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
    - path: "test-output/QC/read1/fastqc/ct_r1_fastqc/fastqc_data.txt"
    - path: "test-output/QCafter/read1/fastqc/cutadapt_ct_r1_fastqc"
    - path: "test-output/AdapterClipping/cutadaptReport.txt"
    - path: "test-output/AdapterClipping/cutadapt_ct_r1.fq.gz"

- name: single_end
  tags:
    - integration
  command: >-
    bash -c '
    TEST_JSON=tests/integration/single_end.json ;
    sed -i "2i\"QC.outputDir\":\"$PWD/test-output\"," $TEST_JSON ;
    cromwell run -i $TEST_JSON QC.wdl'
  stdout:
    contains:
      - "WorkflowSucceededState"
  files:
    # Test adapters detected
    - path: "test-output/QC/read1/extractAdapters/adapter.list"
      contains:
        - "AGATCGGAAGAG"
    - path: "test-output/QC/read1/extractAdapters/contaminations.list"
      contains:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
    # Check adapters removed
    - path: "test-output/QCafter/read1/extractAdapters/adapter.list"
      must_not_contain:
        - "AGATCGGAAGAG"
    - path: "test-output/QCafter/read1/extractAdapters/contaminations.list"
      must_not_contain:
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACGTCCGCATCTCGTATGCCGTCTTCTGCTTG"
        - "GATCGGAAGAGCACACGTCTGAACTCCAGTCACATCACGATCTCGTATGCCGTCTTCTGCTTG"
    - path: "test-output/QC/read1/fastqc/ct_r1_fastqc/fastqc_data.txt"
    - path: "test-output/QCafter/read1/fastqc/cutadapt_ct_r1_fastqc"
    - path: "test-output/AdapterClipping/cutadaptReport.txt"
    - path: "test-output/AdapterClipping/cutadapt_ct_r1.fq"

# paired end zipped is probably > 99% of the use cases. So we only
# test this one functionally.
- name: functional_paired_end_zipped
  tags:
    - functional
  command: >-
    bash -c '
    TEST_JSON=tests/functional/paired_end_zipped.json ;
    sed -i "2i\"QC.outputDir\":\"$PWD/test-output\"," $TEST_JSON ;
    cromwell run -i $TEST_JSON QC.wdl'
  stdout:
    contains:
      - "WorkflowSucceededState"
  files:
    - path: "test-output/QC/read1/extractAdapters/adapter.list"
      contains:
        - "AGATCGGAAGAG"
    - path: "test-output/QC/read2/extractAdapters/adapter.list"
      contains:
        - "AGATCGGAAGAG"
    - path: "test-output/QC/read1/extractAdapters/contaminations.list"

    # Read2 contains no contaminations
    - path: "test-output/QC/read2/extractAdapters/contaminations.list"


    # Check adapters removed
    - path: "test-output/QCafter/read1/extractAdapters/adapter.list"
      must_not_contain:
        - "AGATCGGAAGAG"
    - path: "test-output/QCafter/read2/extractAdapters/adapter.list"
      must_not_contain:
        - "AGATCGGAAGAG"
    - path: "test-output/QCafter/read1/extractAdapters/contaminations.list"
    - path: "test-output/QCafter/read2/extractAdapters/contaminations.list"

    - path: "test-output/QC/read1/fastqc/U0a_CGATGT_L001_R1_fastqc/fastqc_data.txt"
    - path: "test-output/QC/read2/fastqc/U0a_CGATGT_L001_R2_fastqc/fastqc_data.txt"
    - path: "test-output/QCafter/read1/fastqc/cutadapt_U0a_CGATGT_L001_R1_fastqc"
    - path: "test-output/QCafter/read2/fastqc/cutadapt_U0a_CGATGT_L001_R2_fastqc"
    - path: "test-output/AdapterClipping/cutadaptReport.txt"
    - path: "test-output/AdapterClipping/cutadapt_U0a_CGATGT_L001_R1.fastq.gz"
    - path: "test-output/AdapterClipping/cutadapt_U0a_CGATGT_L001_R2.fastq.gz"
